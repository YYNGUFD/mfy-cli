#!/usr/bin/env node
 

const { chalk, program, inquirer } = require('../libs/tools/module')
const packageData = require('../package.json')
const log = console.log;

//å½“å‰cliçš„åç§° 
const cliName = packageData.name;

console.log(chalk.yellowBright.bold(`ğŸŒŸ---------------------------------------ğŸŒŸ\n    ğŸ‘ welcome to use ${cliName}ğŸ‘    \nğŸŒŸ---------------------------------------ğŸŒŸ`));


/**
 * å‚æ•°çš„æ ¼å¼åŒ–æ’ä»¶
 * @param cmd å½“å‰å‘½ä»¤è¡Œä¸­çš„å‘½ä»¤æ•°æ® 
 */
const clearArgs = (cmd) => {
  const args = {};
  cmd.options.forEach(o => {
    const key = o.long.slice(2)
    //å¦‚æœå½“å‰å‘½ä»¤é€šè¿‡keyèƒ½å–åˆ°è¿™ä¸ªå€¼ï¼Œåˆ™å­˜åœ¨è¿™ä¸ªå€¼
    if (cmd[key])
      args[key] = cmd[key];
  });
  return args
} 
// const mapActionList={
//   'create':{
//     alias:'c',
//     description:"create a new projec",
//     options:[
//       '-f,--force overwrite target if it exists',
//     ]
//   },
//   'config':{
//     alias:'conf',
//     description:"inspect and modify the config",
//     options:[
//       '-g,--get <path>  get value from options',
//       '-s,--set <path> <value>  set value from options',
//       '-d,--delete <path> <value>  delete options from config'
//     ]
//   },
//   '*':{
//     alias: '',
//     description:'command not found',
//     examples: []
//   }
// }

//åˆ›å»ºcreateå‘½ä»¤ å¹¶è¿›è¡Œæ“ä½œ 
program.command('create <app-name>')
  .description("create a new project")
  .option("-f,--force", 'overwrite target if it exists')
  .action((name, cmd) => {
    if (!name) {
      log(chalk.red("please write project name"))
      return;
    }
    require('../libs/command/create.js')(name, clearArgs(cmd))
})

  
program.command('config [value]')
  .description("inspect and modify the config")
  .option("-g,--get <path>", 'get value from options')
  .option("-s,--set <path> <value>", 'set value from options')
  .option("-sm,--setTemplate", 'set yourself template')
  .option("-smc,--defaultConfig", 'set default template')
  .option("-d,--delete <path> <value>", 'delete options from config')
  .action((value, cmd) => {
    //è°ƒç”¨config   
    require('../libs/command/config.js')(value, clearArgs(cmd))
  })

//æ·»åŠ é¡¹ç›®é€‰é¡¹ 
program.command('add   [path]')
  .description("add dirtory or file")  
  .option("-f,--force", 'overwrite target if it exists') 
  .option("-t,--template", 'create teemplatee') 
  .action((path, cmd) => {
    let args = clearArgs(cmd); 
    //è°ƒç”¨config 
    if(!path && (args && !args.template)) {
      log(chalk.red.bold("You must to add the path"))
      return ;
    }  
    require('../libs/command/add.js')(path, clearArgs(cmd))
})

//åˆ é™¤é¡¹ç›®
program.command('delete [path]')
  .description("add dirtory or file")  
  .action((path, cmd) => {
    //è°ƒç”¨config 
    if(!path) {
      log(chalk.red.bold("You must to add path"))
      return ;
    } 
    console.log(path)
    require('../libs/command/delete.js')(path, clearArgs(cmd))
})

//credit-cli çš„ç‰ˆæœ¬ä¿¡æ¯
program
  .version(`${cliName}@${packageData.version}`)
  .usage('<command> [option]')

//åœ¨ --help çš„æ—¶å€™è¿›è¡Œè°ƒæ•´
program.on('--help', () => {
  log(`Run ${chalk.red(`${cliName} <command> --help`)} show details`)
})

//è§£æç”¨æˆ·æ‰§è¡Œå‘½ä»¤æ—¶å€™ä¼ å…¥çš„å‚æ•° æ ¹æ®å‚æ•°è¿›è¡Œé…ç½® 
program.parse(process.argv)

if (!program.args.length) {
  program.help()
}



